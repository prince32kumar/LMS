.CommitUpdate:
    stage: Post
    script:
        - CI_PREVIOUS_COMMIT=$(git rev-parse HEAD)
        - |
            if [[ $CI_COMMIT_TAG == PROD_* ]];
            then 
             curl -k --request PUT --header "PRIVATE-TOKEN: $TOKEN" "$CI_API_V4_URL/projects/$CI_PROJECT_ID/variables/CI_PREVIOUS_COMMIT_PROD" --form "value=$CI_PREVIOUS_COMMIT"
            fi
            if [[ $CI_COMMIT_TAG == SIT_* ]];
            then
             curl -k --request PUT --header "PRIVATE-TOKEN: $TOKEN" "$CI_API_V4_URL/projects/$CI_PROJECT_ID/variables/CI_PREVIOUS_COMMIT_SIT" --form "value=$CI_PREVIOUS_COMMIT"
            fi 
            if [[ $CI_COMMIT_TAG == UAT_* ]];
            then
             curl -k --request PUT --header "PRIVATE-TOKEN: $TOKEN" "$CI_API_V4_URL/projects/$CI_PROJECT_ID/variables/CI_PREVIOUS_COMMIT_UAT" --form "value=$CI_PREVIOUS_COMMIT"
            fi     
        #- 'curl -k --request PUT --header "PRIVATE-TOKEN: $TOKEN" "$CI_API_V4_URL/projects/$CI_PROJECT_ID/variables/CI_PREVIOUS_COMMIT" --form "value=$CI_PREVIOUS_COMMIT"'
        #- 'curl -k --capath /home/ec2-user --cacert wild.in-2048.cer --request PUT --header "PRIVATE-TOKEN: $TOKEN" "$CI_API_V4_URL/projects/$CI_PROJECT_ID/variables/CI_PREVIOUS_COMMIT" --form "value=$CI_PREVIOUS_COMMIT"'







include:
    - project: 'templates/template'
      ref: Changeset
      file: 'Changeset.yml'



Changeset:
  stage: Pre
  extends: .Changeset
  tags:
      - docker3
  before_script:
    - echo $CI_COMMIT_SHA
  image: docker.io/bitnami/git:latest
  artifacts:
    paths:
      - Target/*
    expire_in: 1 week
  rules:
    - if: $CI_COMMIT_TAG =~ /^UAT_.*/
